/**
* Vibe.
* (c) 2021 Bret Lowry
* @license MIT
* @description VibeJS a component library for composing apps
* @author Bret Lowry <bretgeek@gmail.com>
* @constructor
* @param {object} $self - optional, defaults to document.
* @return {object} obj with keys pointing to functions and types
*/
function Vibe(e=document,{fn:t={}}={}){let n=false;if(e.nodeName==="#document"){n=true}let r=false;if(n){(function e(){if(document.readyState!="loading"){r=true}else if(document.addEventListener){document.addEventListener("DOMContentLoaded",(function(){r=true}))}else{document.attachEvent("onreadystatechange",(function(){if(document.readyState!="loading"){r=true}}))}})()}function i(e,t=3e3){let n;let i;let s=1;n=setInterval(()=>{if(r){clearInterval(n);clearTimeout(i);if(e&&Y(e)&&s<=1){try{e();s++}catch(e){console.error(e)}}else{return true}}},6);i=setTimeout(()=>{r=true},t)}function s(e,{to:r="body",type:s="div",position:f="append",state:u={},props:l={},plugin:a={},events:c={},className:d="vibe"}={}){let p=r;if(!z(p)){p=document.querySelector(r)}if(Y(e)){const t=e();if(n){}const h=document.createElement(`${s}`);h.$=new Vibe(h);if(t.template&&t.template.length){h.innerHTML=t.template}if(t.className&&t.className.length){h.classList.add(t.className)}h.classList.add(d);h.$plugin=a;if(t.fn){if(Object.keys(t.fn).length>0){h.$fn=t.fn}}h.$props=l;h.$self=h;if(t.state){h.$state=t.state;h.$origState=t.state}else{h.$state=u;h.$origState=u}if(t.events){if(Object.keys(t.events).length>0){h.$event=t.events;for(const e in h.$event){h.addEventListener(e,h.$event[e],true)}}}if(Object.keys(c).length>0){h.$event=c;for(const e in h.$event){h.addEventListener(e,h.$event[e],true)}}h.id=U();if(z(p)){i(o(h,p,f));h.$mountedTo=r}else{let e=0;const t=setInterval((function(){e++;if(z(p)){i(o(h,p,f));h.$mountedTo=r;clearInterval(t)}if(e>60){clearInterval(t);throw new Error(`Whoops! could not mount to ${r} element.`)}}),100)}if(Y(t.init)){h.init=t.init;i(h.init(h))}return h}else{if(e.nodeType===1){e.$=new Vibe(e);e.$plugin=a;e.classList.add(d);e.$props=l;e.$self=e;e.$state=u;e.$origState=u;if(Object.keys(c).length>0){e.$event=c;for(const t in e.$event){e.addEventListener(t,e.$event[t],true)}}if(!e.id){e.id=U()}return e}else if(H(e)){let n=null;if(m(e)){let t;t=m(e,true);n=document.createElement(`${t[0]}`);n.innerHTML=t[1]}else{n=document.createElement(`${s}`);n.innerHTML=e}n.$=new Vibe(n);if(Object.keys(t).length>0){n.$fn=t}n.$props=l;n.$self=n;n.$obj=n.$;n.classList.add(d);n.$state=u;n.$origState=u;n.$plugin=a;if(Object.keys(c).length>0){n.$events=c;for(const e in n.$events){n.addEventListener(e,n.$events[e],true)}}n.id=U();i(o(n,p,f));return n}}}function o(e,t,n){switch(n){case"after":e.$insertAfter(t);break;case"before":e.$insertBefore(t);break;case"prepend":e.$prependTo(t);break;default:e.$appendTo(t);break}return this}function f(t="mousedown",n,r=false){let i=r;if(typeof r==="boolean"){if(r){i={capture:true}}else{i={capture:false}}}const s=t.split(",");for(let t of s){t=t.trim();e.addEventListener(t,n,i)}return this}function u(t="mousedown",n,r=false){const i=e;let s=r;if(typeof r==="boolean"){if(r){s={capture:true}}else{s={capture:false}}}const o=t.split(",");for(const e of o){i.removeEventListener(e,n,s)}return this}function l(t){const n=e;const r=new Event(t);n.dispatchEvent(r,{bubbles:true,cancelable:true});return this}function a(t,{all:n=false,vibe:r=true,fn:i=false}={}){if(!n){let n=false;if(t.startsWith("#")){t=t.replace(/#/,"");n=document.getElementById(t)}else{n=e.querySelectorAll(t)[0]}if(n){if(r){n.$=Vibe().render(n)}if(Y(i)){i(n)}return n}else{return false}}else{const n=e.querySelectorAll(t);if(n.length){if(r){n.forEach(e=>{e.$=Vibe().render(e)})}if(Y(i)){n.forEach(e=>{i(e)})}return n}else{return false}}}function c(e){e=e.toString();e=e.replace(/px/g,"");e=e.replace(/%/g,"");e=e.replace(/em/g,"");e=Math.round(Number(e));return e}function d(t,n=false){let r=getComputedStyle(e).getPropertyValue(t)||null;if(n){try{r=c(r)}catch(e){console.error(e)}}return r}function p(t=false,n=false){const r=["x","y","width","height","right","left","top","bottom"];if(!r.includes(t)){return null}const i=e.getBoundingClientRect()[t];if(n){return Math.round(i)}else{return i}}function h(e){const t=document.createElement(e[0]);t.innerHTML=e[1];return t}function m(e,t=false){const n=(new DOMParser).parseFromString(e,"text/html");if(t){return[n.body.childNodes[0].tagName.toLowerCase(),n.body.childNodes[0].innerHTML]}else{return Array.from(n.body.childNodes).some(e=>e.nodeType===1)}}function $(t=false){if(n){return this}if(!t){return e.textContent}else{e.textContent=t;return this}}function b(t=false){if(n){return this}if(!t){return e.innerHTML}else{e.innerHTML=t;return this}}function v(e){x(e);return this}function y(e){x(e,true);return this}function g(e){x(e,true,true);return this}function w(e){x(e,false,true);return this}function x(t,r=false,i=false){if(n){return this}const s=e;if(H(t)){let e;if(m(t)){e=h(m(t,true),true);if(!e){return this}}else{e=document.querySelectorAll(t)[0];if(!e){return this}}if(r){if(i){e.before(s)}else{s.before(e)}}else{if(i){e.after(s)}else{s.after(e)}}}if(z(t)){if(r){if(i){t.before(s)}else{s.before(t)}}else{if(i){t.after(s)}else{s.after(t)}}}return this}function E(t,r=false){if(n){return this}const i=e;if(!t){return this}if(H(t)){let e;if(m(t)){e=h(m(t,true),true)}else{e=t}if(r){i.prepend(e)}else{i.append(e)}}else{if(r){i.prepend(t)}else{i.append(t)}}return this}function L(e){if(n){return this}if(!e){return this}E(e,true);return this}function T(e){if(!e){return this}k(e,true);return this}function q(e){if(!e){return this}k(e);return this}function k(t,r=false){if(n){e=e.body}const i=e;if(H(t)){const e=document.querySelectorAll(t)[0];if(!e){return this}if(r){e.prepend(i)}else{e.append(i)}}if(z(t)){if(r){t.prepend(i)}else{t.append(i)}return this}}function M(t,{add:r=true}={}){if(n){return this}if(!t){return this}if(!r){e.style.cssText=t}else{e.style.cssText=e.style.cssText+t}return this}function S(t="div",{override:r=false,position:i=false,to:s=false}={}){const o=["html","head","link","meta","script","style","title","body","article","aside","footer","header","h1","h2","h3","h4","h5","h6","main","nav","section","blockquote","div","figure","hr","li","ol","p","pre","ul","a","code","data","time","em","i","span","strong","audio","source","img","track","video","iframe","svg","canvas","noscript","col","colgroup","button","option","fieldset","label","form","input","select","textarea","menu","template"];if(!o.includes(t)){if(!r){t="div"}}const f=document.createElement(t);const u=f;u.$=Vibe().render(f);if(!s){s=e}if(n&&!s){return u}if(!z(s)){s=document.querySelector(s)}if(n){if(!s){s=document.body}if(i){if(i!=="prepend"){if(i!=="append"){i="append"}}}}if(i&&s){switch(i){case"after":u.$insertAfter(s);break;case"before":u.$insertBefore(s);break;case"prepend":u.$prependTo(s);break;default:u.$appendTo(s);break}return u}else{return u}}function A(t=false){if(n){return this}let r=false;let i="";if(t){i=e.id;r=e.cloneNode(true)}e.remove();if(t){r.$=new Vibe(r);r.id=i;return r}else{return this}}function O({to:t=false,position:r="append"}={}){if(n){return this}const s=e.cloneNode(true);s.$=new Vibe(s);s.id=U();if(t){if(!z(t)){t=document.querySelector(t)}i(o(s,t,r))}return s}function j(t,r=false){if(n){return this}const i=e;if(!r){i.classList.add(t)}else{i.classList.remove(t)}return this}function V(e){if(n){return this}j(e,true);return this}function N(e){if(n){return this}I(e,false,true);return this}function I(t,r=false,i=false){if(n){return this}const s=e;if(t&&H(t)){if(i){s.removeAttribute(t);return this}if(H(r)||typeof r==="number"){s.setAttribute(t,r);return this}if(!r){const e=s.getAttribute(t);return e}}}function C(){if(n){return this}return e.dataset}function D(t,r="set"){const i=e;if(n){return this}if(r==="remove"){i.removeAttribute("data-"+t)}if(r==="set"){i.setAttribute("data-"+t,t)}if(r==="get"){return i.getAttribute("data-"+t)}}function B({str:t=false,fn:n=false,vibe:r=false,match:i=false}){let s=[];let o;let f=e;if(H(i)){o=i.split(",");while(f=f.parentElement){o.forEach(e=>{e=e.trim();if(f.matches(e)&&!s.includes(f)){s.push(f);console.log(f.classList)}})}}if(!i){while(f=f.parentElement){s.push(f)}}if(s.length){s=s.filter((e,t,n)=>n.indexOf(e)==t);if(r){for(const e of s){e.$=new Vibe(e)}}if(Y(n)){for(const e of s){n(e)}}}return s}function F({match:t=false,fn:n=false,vibe:r=false}){const i=[];let s;const o=e;const f=e.getElementsByTagName("*");if(H(t)){s=t.split(",");for(const e of f){s.forEach(t=>{t=t.trim();if(e.matches(t)){i.push(o)}})}}if(!t){for(const e of f){i.push(e)}}if(i.length){if(r){for(const e of i){e.$=new Vibe(e)}}if(Y(n)){for(const e of i){n(e)}}}return i}function H(e){return typeof e==="string"}function P(e){return/^-{0,1}\d+$/.test(e)}function X(e){const t=/^-?[0-9]+$/;return t.test(e)}function Y(e){return typeof e==="function"}function R(e){return typeof e==="object"}function z(e){return R(e)&&e.nodeType==1}function W(e){if(Array.isArray(e)){return true}else{return false}}function U(){if(R(crypto)){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}else{let e=(new Date).getTime();let t=performance&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{let r=Math.random()*16;if(e>0){r=(e+r)%16|0;e=Math.floor(e/16)}else{r=(t+r)%16|0;t=Math.floor(t/16)}return(n=="x"?r:r&7|8).toString(16)})}}function _(e,t=false){e=e.replace(/[^\x20-\x7E]+/g,"");if(t){e=e.replace(/[^a-z0-9-#]+|\s+/gim,"")}e=e.trim();return e}function G(){if(n){return this}return e.id}function J(t){if(Y(t)){const r=t.name;if(n){document.$plugin[r]=t}else{e.$plugin[r]=t}}return this}function K(t){if(Y(t)){t(e)}return this}function Q(t={}){if(n){return this}e.$state=t}function Z(t){if(n){return this}return e.$state[t]}function ee(t,n="name",{delay:r=10,child:i=true,attr:s=true,subtree:o=false,attrs:f=["none"],chardat:u=false,attrsOV:l=false,chardatOV:a=false}){if(typeof t!=="function"){return}const c={childList:i,attributes:s,characterData:u,subtree:o,attributeFilter:f,attributeOldValue:l,characterDataOldValue:a};const d=e;const p=new MutationObserver((function(e){e.forEach((function(e){if(e.type==="attributes"){if(f[0]!=="none"){setTimeout(()=>{t(d)},r)}}else{if(f[0]==="none"){if(e.type==="childList"||e.type==="subtree"||e.type==="characterData"){setTimeout(()=>{t(d)},r)}}}}))}));if(e.$observers[n]){e.$observers[n].disconnect();delete e.$observers[n]}e.$observers[n]=p;e.$observers[n].observe(e,c);const h=Object.keys(e.$observers);return this}function te(t="name"){if(t==="all"){const t=Object.keys(e.$observers);for(const n of t){delete e.$observers[n];n.disconnect()}}else{if(e.$observers[t]){e.$observers[t].disconnect();delete e.$observers[t]}}return this}function ne(){const t=Object.keys(e.$observers);return t}async function re({url:e=false,type:t="json",fn:n=false,e:r={}}={}){const i=await fetch(e);let s;if(t=="json"){s=await i.json()}if(t=="text"){s=await i.text()}if(Y(n)){n(s,r)}}function ie({url:t=false,type:n="text",body:r=false,contentType:i="application/x-www-form-urlencoded",fn:s=false}={}){e.isPost=false;if(!t||!r){return false}fetch(t,{headers:new Headers({"Content-Type":`${i}`}),method:"post",body:r}).then((function(e){if(e.ok){if(n==="json"){return e.json()}else{return e.text()}}return Promise.reject(e)})).then((function(t){e.isPost=true;if(Y(s)){s(t)}})).catch((function(e){console.warn("Something went wrong.",e)}))}function se(){return window.matchMedia("(pointer: coarse)").matches||false}function oe(){setTimeout((function(){e.onfocus=blur()}),100);return this}window.requestInterval=function(e,t){const n=Date.now;const r=window.requestAnimationFrame;let i=n();let s;var o=function(){n()-i<t||(i+=t,e());s||r(o)};r(o);return{clear:function(){s=1}}};function fe({display:t="block",speed:n=300}={}){function r(){const r=e.$cs("display");e.$css(`display: ${r}; visibility: visible; opacity: 0.0;`,{add:true});e.$css(`display: ${t}; visibility: visible;`,{add:true});let i=0;const s=requestInterval((function(){i++;if(i<=9){e.$css(`opacity: 0.${i} `,{add:true})}else{i=1;e.$css(`opacity: ${i} `,{add:true});e.$isrun=false;e.$runq();s.clear()}}),n)}e.$q.push(r);if(e.$q.length){e.$runq()}return this}function ue({display:t="block",speed:n=300}={}){function r(){const r=e.$cs("display");e.$css(`display: ${r}; visibility: visible; opacity: 1;`,{add:true});e.$css(`display: ${t}; visibility: visible;`,{add:true});let i=1;const s=requestInterval((function(){if(i>.1){i-=.1;i=i.toFixed(2);e.$css(`opacity: ${i} `,{add:true})}else{i=0;e.$css(`opacity: ${i} `,{add:true});e.$isrun=false;e.$runq();s.clear()}}),n)}e.$q.push(r);if(e.$q.length){e.$runq()}return this}function le(){e.$fadeIn({speed:1});return this}function ae(){e.$fadeOut({speed:1});return this}function ce({time:t=1e3,fn:n=false}){function r(){const r=new Date;const i=r.getTime()+t;const s=requestInterval((function(){const t=new Date;if(t.getTime()>=i){if(Y(n)){n(e)}e.$isrun=false;e.$runq();s.clear()}}),1)}e.$q.push(r);if(e.$q.length){e.$runq()}return this}function de(){let t;if(!e.$isrun){e.$isrun=true;t=e.$q.shift();if(Y(t)){t(e);de()}}return null}function pe(e,t){return document.elementFromPoint(e,t)}function he(e=0){let t=window.location.pathname;const n=t;t=t.split("/");const r=t[e];if(r.length&&e>0){return r}else{return n}}function me({el:t=false,el2:r=false}){if(n&&!r){return this}if(!r){r=e}const i=t.getBoundingClientRect();const s=r.getBoundingClientRect();return!(i.top+i.height<s.top||i.top>s.top+s.height||i.left+i.width<s.left||i.left>s.left+s.width)}function $e({draghandle:t=false,contain:n="body",dropfn:r=false,drop:i=false,zIndex:s=1}={}){const o=e;let f=false;let u;let l;let a;let c;let d=0;let p=0;const h=document.querySelectorAll(n)[0];const m=o.parentNode||o.parentElement;const $=o;let b;if(i&&H(i)){b=document.querySelector(i)}m.addEventListener("touchstart",v,false);m.addEventListener("touchend",y,false);m.addEventListener("touchmove",g,false);m.addEventListener("mousedown",v,false);m.addEventListener("mouseup",y,false);h.addEventListener("mouseleave",y,false);m.addEventListener("mousemove",g,false);function v(e){const n=o.$cs("position");if(n!=="absolute"){o.$css("position: absolute;")}if(e.type==="touchstart"){a=e.touches[0].clientX-d;c=e.touches[0].clientY-p}else{a=e.clientX-d;c=e.clientY-p}if(e.target.matches(t)||!t){e.target.style.cssText="user-select: none; cursor: pointer;";f=true}}function y(t){a=u;c=l;if(b&&o.$isTouching({el:b})&&f){r({dragee:e,dropee:b});f=false}f=false}function g(e){if(f){e.preventDefault();if(e.type==="touchmove"){u=e.touches[0].clientX-a;l=e.touches[0].clientY-c}else{u=e.clientX-a;l=e.clientY-c}d=u;p=l;w(u,l,$)}}function w(e,t,n){n.style.transform="translate3d("+e+"px, "+t+"px, 0)"}return this}function be({node:t=e,drop:n=false,dropfn:r=false,upfn:i=false,downfn:s=false,leftfn:o=false,rightfn:f=false}={}){const u=t;u.addEventListener("touchstart",c,false);u.addEventListener("touchmove",d,false);let l=null;let a=null;function c(e){l=e.touches[0].clientX;a=e.touches[0].clientY}function d(e){if(l===null){return}if(a===null){return}const n=e.touches[0].clientX;const r=e.touches[0].clientY;const u=l-n;const c=a-r;if(Math.abs(u)>Math.abs(c)){if(u>0){if(Y(o)){o(t)}}else{if(Y(f)){f(t)}}}else{if(c>0){if(Y(i)){i(t)}}else{if(Y(s)){s(t)}}}l=null;a=null;e.preventDefault()}return this}function ve(e){if(Y(e)){window.addEventListener("load",e,true)}return this}function ye(e){if(Y(e)){window.addEventListener("scroll",e,true)}return this}function ge(e,t,n=false){if(n){window.removeEventListener(e,t,true)}else{window.addEventListener(e,t,true)}return this}function we(...e){return t=>e.reduce((e,t)=>t(e),t)}function xe({end:t=false,fn:n=(()=>{})}={}){if(Y(n)){e.$stream.push(n)}if(t){const t=we(...e.$stream);return t()}else{return this}}function Ee(t){const n=Le(t.easing);let r=false;if(t.done){r=t.done}let i=false;let s=false;let o=false;let f;if(t.move&&Y(t.move)){f=t.move}if(t.move&&!Y(t.move)){i=t.move.dir||"right";s=t.move.amt||0;o=t.move.unit||"px";if(i==="left"){f=function(t){e.$css(`left:  -${Math.round(t*s)}px`)}}if(i==="right"){f=function(t){e.$css(`left:  ${Math.round(t*s)}${o}`)}}if(i==="down"){f=function(t){e.$css(`top:  ${Math.round(t*s)}${o}`)}}if(i==="up"){f=function(t){e.$css(`bottom:  ${Math.round(t*s)}${o}`)}}}let u=false;if(t.prop.opacity){u=t.prop.opacity||"pos";if(u==="pos"){f=function(n){if(t.prop.to){if(n>=t.prop.to){n=t.prop.to}}e.$css(`opacity:  ${n};`)}}if(u==="neg"){f=function(n){let r=e.$cs("opacity");r-=n;if(t.prop.to){if(r<=t.prop.to){r=t.prop.to}}if(r<=0){r=0}e.$css(`opacity:  ${r};`)}}}let l=0;let a="";let c="width";let d="";let p=null;if(t.prop&&!t.prop.opacity){a=t.prop.unit||"px";d=t.prop.sign||"";c=Object.entries(t.prop)[0][0]||"width";c=c.replace(/_/g,"-");p=Object.entries(t.prop)[0][1]||null;l=e.$cs(`${c}`,true);f=function(t){l=e.$cs(`${c}`,true);let n;if(!X(l)){n=l+t;a=""}else{n=Math.round(l+t*2)}if(n>=p||l>=p){n=p}e.$css(`${c}:  ${d}${n}${a};`)}}const h=e.$cs("position");if(h==="static"&&n){e.$css(`position: relative;`)}const m=performance.now();requestAnimationFrame((function i(s){let o=(s-m)/t.duration;if(o>1)o=1;const u=n(o);if(t.move&&Y(t.move)){f(e,u)}else{f(u)}if(o<1){requestAnimationFrame(i)}else{if(Y(r)){r()}}}));return this}function Le(e){switch(e){case"bounceEaseOut":return ke;break;case"bounceEaseInOut":return Se;break;case"bounce":return qe;break;default:return ke;break}}function Te(e){return function(t){return 1-e(1-t)}}function qe(e){for(let t=0,n=1,r;1;t+=n,n/=2){if(e>=(7-4*t)/11){return-Math.pow((11-6*t-11*e)/4,2)+Math.pow(n,2)}}}var ke=Te(qe);function Me(e){return function(t){if(t<.5){return e(2*t)/2}else{return(2-e(2*(1-t)))/2}}}var Se=Me(qe);const Ae={fn:t,id:G,uuid:U,clone:O,ready:i,get:re,post:ie,css:M,isTouch:se,rpx:c,addClass:j,removeClass:V,children:F,parents:B,before:y,insertBefore:g,insertAfter:w,after:v,append:E,prepend:L,select:a,attr:I,removeAttr:N,appendTo:q,prependTo:T,createNode:S,filterString:_,dataset:C,data:D,detach:A,render:s,addplug:J,run:K,plugin:{},doc:document,rect:p,mountedTo:false,cs:d,on:f,observe:ee,observers:{},unobserve:te,getobservers:ne,off:u,trigger:l,html:b,text:$,pager:he,getState:Z,setState:Q,isFunction:Y,isObject:R,isElement:z,isArray:W,isString:H,isNumber:P,getAtPt:pe,isTouching:me,drag:$e,swipe:be,load:ve,scroll:ye,show:le,hide:ae,delay:ce,fadeIn:fe,fadeOut:ue,q:[],runq:de,isrun:false,w:ge,pipe:xe,stream:[],animate:Ee};for(const t in Ae){const n="$"+t;e[n]=Ae[t]}return Ae}var $vibe=new Vibe(document);
